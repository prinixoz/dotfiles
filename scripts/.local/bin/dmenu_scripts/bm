#!/usr/bin/env bash

file="$HOME/.config/bm/bm"

# Format and choose a line using fzf
selected=$(sort $file| sed -e '/^\s*#/d' | column -ts "|" -o "$(printf "%50s")|" | $@ )

# Exit if nothing selected
[ -z "$selected" ] && exit 1

# Parse fields
link=$(echo "$selected" | awk -F "|" '{print $2}' | xargs)
command=$(echo "$selected" | awk -F "|" '{print $NF}' | xargs)
cmd_exec=$(echo "$command" | awk '{print $1}')

# Check if command exists
if command -v "$cmd_exec" > /dev/null 2>&1; then
    echo "Running: $command $link"
    eval "$command \"$link\""
else
    echo "Fallback: opening in librewolf"
    librewolf -P default "$link"
fi

